// ZzFX - Zuper Zmall Zound Zynth - MIT License - Copyright 2019 Frank Force
class _ZZFX{constructor(){this.x=this.CreateAudioContext(),this.samples=0,this.volume=.3,this.sampleRate=44100}Play(t){if(!t||"object"!=typeof t){var e=this.BuildSound();t=this.BuildSound(...arguments);for(const a in t)void 0===t[a]&&(t[a]=e[a])}return e=this.SoundToArray(t),e=this.BuildSamples(...e,this.volume),this.PlaySamples(e)}PlaySamples(t){const e=this.x.createBuffer(1,t.length,this.sampleRate),a=this.x.createBufferSource();return e.getChannelData(0).set(t),a.buffer=e,a.connect(this.x.destination),a.start(),this.samples=t,a}BuildSamples(t,e,a,s,n,o,i,r,u,h,d,l,c,m,p,f,M,S=1){const B=2*Math.PI;var C=this.sampleRate;const x=u*=500*B/C**2,v=(0<p?1:-1)*B/4;e=a*=(1+e*(2*Math.random()-1))*B/C,s=99+s*C|0,n=n*C|0,o=o*C|0,M=M*C|0,h*=500*B/C**3,p*=B/C,d*=B/C,l*=C,c*=C,C=Math.max(1,Math.min(s+n+o+M,10*C));let y=[],Z=0,b=0,A=0,T=1,w=0,P=0,F=0;for(;A<C;y[A++]=F)++P>100*f&&(P=0,F=Z*a*Math.sin(b*p-v),F=(0<(F=i?1<i?2<i?3<i?Math.sin((F%B)**3):Math.max(Math.min(Math.tan(F),1),-1):1-(2*F/B%2+2)%2:1-4*Math.abs(Math.round(F/B)-F/B):Math.sin(F))?1:-1)*Math.abs(F)**r,F*=t*S*(A<s?A/s:A<s+n?1:A<C-M?1-(A-s-n)/o:0),F=M?F/2+(M>A?0:(A<C-M?1:(A-C)/M)*y[A-M]/2):F),Z+=1+m*(2*Math.random()-1),b+=1+m*(2*Math.random()-1),a+=u+=h,T&&++T>l&&(e+=d,a+=d,T=0),c&&++w>c&&(a=e,u=x,w=1,T=T||1);return y}BuildRandomSound(){function t(){return Math.random()}const e=this.BuildSound(1,.05,2e3*t()**2|0,.01+t()**3,t()**3,.01+t()**3,5*t()|0,.2>t()?1:2*t(),.5>t()?0:100*t()**3*(.5>t()?-1:1),.5>t()?0:100*t()**3*(.5>t()?-1:1),0,0,0,.5>t()?0:3*t()**3,.5>t()?0:100*t()**3*(.5>t()?-1:1),.5>t()?0:t()**2,.5>t()?0:.5*t()**3);.1>t()&&(e.shapeCurve=10*t()**2),2<=e.shapeCurve&&(e.shapeCurve|=0),.5>t()&&(e.modulation*=-1);const a=e.attack+e.sustain+e.release;return.5>t()&&(e.pitchJump=1e3*t()**2*(.5>t()?-1:1)|0,e.pitchJumpTime=t()*a),.5>t()&&(e.repeatTime=t()*a),e}BuildSound(t=1,e=.05,a=220,s=0,n=0,o=.1,i=0,r=1,u=0,h=0,d=0,l=0,c=0,m=0,p=0,f=0,M=0){return{volume:t,randomness:e,frequency:a,attack:s,sustain:n,release:o,shape:i,shapeCurve:r,slide:u,deltaSlide:h,pitchJump:d,pitchJumpTime:l,repeatTime:c,noise:m,modulation:p,bitCrush:f,delay:M}}GetNote(t,e){return t*2**(e/12)}SoundToArray(t){const e=this.BuildSound(),a=[];for(const s in e)a.push(t[s]);return a}CreateAudioContext(){const t=new(window.AudioContext||webkitAudioContext);return t.a=t.createBufferSource,t.createBufferSource=((e=t.a())=>(e.start=e.start||(e=>t.noteOn(e)),e.stop=e.stop||(e=>t.noteOff(e)),e)),t}}const ZZFX=new _ZZFX;function zzfx(){ZZFX.Play(...arguments)}